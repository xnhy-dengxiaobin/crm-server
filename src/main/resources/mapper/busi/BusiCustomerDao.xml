<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.renren.modules.busi.dao.BusiCustomerDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="io.renren.modules.busi.entity.BusiCustomerEntity" id="busiCustomerMap">
        <result property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="sex" column="sex"/>
        <result property="mobilePhone" column="mobile_phone"/>
        <result property="projectId" column="project_id"/>
        <result property="purpose" column="purpose"/>
        <result property="purposeProduct" column="purpose_product"/>
        <result property="purposeArea" column="purpose_area"/>
        <result property="purposeType" column="purpose_type"/>
        <result property="purposeOrientation" column="purpose_orientation"/>
        <result property="purposeFloor" column="purpose_floor"/>
        <result property="grade" column="grade"/>
        <result property="area" column="area"/>
        <result property="profession" column="profession"/>
        <result property="quantity" column="quantity"/>
        <result property="follow" column="follow"/>
        <result property="matchUserId" column="match_user_id"/>
        <result property="matchUserName" column="match_user_name"/>
        <result property="head" column="head"/>
        <result property="followLast" column="follow_last"/>
        <result property="channel" column="channel"/>
        <result property="comeCount" column="come_count"/>
        <result property="source" column="source"/>
        <result property="sourceName" column="source_name"/>
        <result property="sourceMobile" column="source_mobile"/>
        <result property="followMode" column="follow_mode"/>
        <result property="familyStructure" column="family_structure"/>
        <result property="idType" column="id_type"/>
        <result property="idNumber" column="id_number"/>
        <result property="address" column="address"/>
        <result property="situation" column="situation"/>
        <result property="status" column="status"/>
        <result property="followNextDate" column="follow_next_date"/>
        <result property="followDate" column="follow_date"/>
        <result property="followUserId" column="follow_user_id"/>
        <result property="remark" column="remark"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="expiredTime" column="expired_time"/>
    </resultMap>

    <select id="selectByPhone" parameterType="string" resultMap="busiCustomerMap">
        select t1.*,t2.name as match_user_name,t2.head
        from busi_customer t1
        left join sys_user t2 on t1.match_user_id=t2.user_id
        where t1.mobile_phone like '%${mobilePhone}'
    </select>
  <select id="normalFollowPage" resultType="io.renren.modules.busi.entity.BusiCustomerEntity">
    select t1.*,t2.name as projectName,t3.name as matchName from busi_customer t1 left join busi_project t2 on(t1.project_id = t2.id) left join sys_user t3 on (t1.old_match_user_id=t3.user_id) where 1=1
    <if test="projectId!=null">
      and t1.project_id=#{projectId}
    </if>
    <if test="userId!=null">
      and t1.match_user_id = #{userId}
    </if>
<!--    <if test="keywords!=null and keywords.toString()!=''">-->
<!--      and instr(t1.mobile_phone,#{keywords})-->
<!--    </if>-->
    and t1.status =1 and  DATEDIFF(now(),t1.match_user_time) &lt;= (select `value` from sys_setup where key_n='逾期时间')
  </select>
  <select id="timeoutPage" resultType="io.renren.modules.busi.entity.BusiCustomerEntity">
    select t1.*,t2.name as projectName,t3.name as matchName from busi_customer t1 left join busi_project t2 on(t1.project_id = t2.id) left join sys_user t3 on (t1.old_match_user_id=t3.user_id) where 1=1
    <if test="projectId!=null">
      and t1.project_id=#{projectId}
    </if>
    <if test="userId!=null">
      and t1.match_user_id = #{userId}
    </if>
    <if test="keywords!=null and keywords.toString()!=''">
      and instr(t1.mobile_phone,#{keywords})
    </if>
     and t1.status =1 and  DATEDIFF(now(),t1.match_user_time) > (select `value` from sys_setup where key_n='逾期时间')

  </select>
  <select id="publicPage" resultType="io.renren.modules.busi.entity.BusiCustomerEntity">
    select t1.*,t2.name as projectName,t3.name as oldMatchName from busi_customer t1 left join busi_project t2 on(t1.project_id = t2.id) left join sys_user t3 on (t1.old_match_user_id=t3.user_id) where
    1=1
    <if test="keywords!=null and keywords.toString()!=''">
      and instr(t1.mobile_phone,#{keywords})
    </if>
    <if test="projectId!=null">
     and t1.project_id=#{projectId}
    </if>
     and t1.match_user_id is null and t1.status =2
  </select>
</mapper>
